<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="styles.css">
    <title>PMDB: Home</title>

    <script>
        function makeGetRequest() {
            const url = document.getElementById("search").value;
            const cat = document.querySelector('input[name="searchCat"]:checked').value;
            const xhttp = new XMLHttpRequest();

            //Check which radio button is selected, send GET based on this info
            if (cat == "artist") {
                xhttp.open("GET", "http://127.0.0.1:5000/songsByArtist?artist_name=" + url, true);
            }
            else if (cat == "title") {
                xhttp.open("GET", "http://127.0.0.1:5000/songsByTitle?song_name=" + url, true);
            }
            else if (cat == "album") {
                xhttp.open("GET", "http://172.0.0.1:5000/songsByAlbum?album_name=" + url, true);
            }

            //Runs once the request recieves a response
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    const jsonString = this.responseText;
                    const parseData = JSON.parse(jsonString);
                    const dataArray = Object.values(parseData);
                    console.log(dataArray);

                    //Create table body / clear prior searches 
                    const tableBody = document.getElementById("resultTable").getElementsByTagName('tbody')[0];
                    tableBody.innerHTML = '';

                    //If parsed data array has more than 3 values, loop through array and create rows in output table
                    if (dataArray.length > 3) {
                        dataArray.forEach(item => {
                            console.log(typeof item);

                            //Create rows and cells in output table
                            const row = document.createElement('tr');
                            const titleCell = document.createElement('td');
                            const artistCell = document.createElement('td');
                            const albumCell = document.createElement('td');

                            const newRow = tableBody.insertRow();

                            //Add values to new row
                            titleCell.textContent = item.song_name;
                            artistCell.textContent = item.artist_name;
                            albumCell.textContent = item.album_name;

                            row.appendChild(titleCell);
                            row.appendChild(artistCell);
                            row.appendChild(albumCell);

                            tableBody.appendChild(row);
                            //console.log('success1');
                        });
                    }
                    //If parsed data has less than 3 values, create single row in output table
                    else {
                        //Create rows and cells in output table
                        const row = document.createElement("tr");
                        const titleCell = document.createElement("td");
                        const artistCell = document.createElement("td");
                        const albumCell = document.createElement("td");

                        //Add values to new row
                        titleCell.textContent = item.song_name;
                        artistCell.textContent = item.artist_name;
                        albumCell.textContent = item.album_name;

                        row.appendChild(titleCell);
                        row.appendChild(artistCell);
                        row.appendChild(albumCell);

                        tableBody.appendChild(row);
                        //console.log("success2");
                    }
                };
            };
            xhttp.send();
        }
    </script>

</head>

<body>

    <h1>Personalized Music Database: Home</h1>

    <!-- Top nav bar -->
    <div id="topnav">
        <a href="main.html">Home</a>
        <a href="create.html">Create</a>
        <a href="update.html">Update</a>
    </div>

    <hr />

    <!-- Searchbar and radio options  -->
    <form onsubmit="makeGetRequest(); return false;">
        <input type="submit" value="Submit">
        <input type="text" placeholder="Search . . . " id="search" name="search">
        <label for="title">Title</label>
        <input type="radio" id="title" name="searchCat" value="title" checked>
        <label for="artist">Artist</label>
        <input type="radio" id="artist" name="searchCat" value="artist">
        <label for="artist">Album</label>
        <input type="radio" id="album" name="searchCat" value="album">
    </form>

    <!-- Table for results -->
    <div id="results">
        <table id="resultTable">
            <thead id="resultHead">
                <tr>
                    <th>Title</th>
                    <th>Artist</th>
                    <th>Album</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

</body>

</html>
